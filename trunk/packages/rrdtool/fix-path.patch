--- ../../../openwrt_trunk.orig/feeds/packages/utils/rrdtool/Makefile	2012-05-02 16:17:35.154278152 +0400
+++ ../../../openwrt_trunk/feeds/packages/utils/rrdtool/Makefile	2012-05-03 08:32:13.277473092 +0400
@@ -74,7 +74,7 @@
 	--disable-tcl \
 	--disable-ruby \
 	--without-x \
-	--with-rrd-default-font="/usr/share/rrdtool/fonts/DejaVuSansMono-Roman.ttf" \
+	--with-rrd-default-font="/opt/share/rrdtool/fonts/DejaVuSansMono-Roman.ttf" \
 
 CONFIGURE_VARS += \
 	rd_cv_ieee_works=yes \
@@ -96,36 +96,39 @@
   CONFIGURE_ARGS += --disable-python
 endif
 
+TARGET_LDFLAGS += \
+	-Wl,-rpath-link=$(STAGING_DIR)/opt/lib
+
 define Build/Compile
 	$(if $(Build/Compile/PyMod),,@echo Python packaging code not found.; false)
 	$(call Build/Compile/Default)
 endef
 
 define Build/InstallDev
-	$(INSTALL_DIR) $(1)/usr/lib/rrdtool-1.2/include
-	$(CP) $(PKG_INSTALL_DIR)/usr/include/rrd.h $(1)/usr/lib/rrdtool-1.2/include/
-	$(INSTALL_DIR) $(1)/usr/lib/rrdtool-1.2/lib
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/librrd{,_th}.{a,so*} $(1)/usr/lib/rrdtool-1.2/lib/
+	$(INSTALL_DIR) $(1)/opt/lib/rrdtool-1.2/include
+	$(CP) $(PKG_INSTALL_DIR)/opt/include/rrd.h $(1)/opt/lib/rrdtool-1.2/include/
+	$(INSTALL_DIR) $(1)/opt/lib/rrdtool-1.2/lib
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/librrd{,_th}.{a,so*} $(1)/opt/lib/rrdtool-1.2/lib/
 endef
 
 define Package/librrd/install
-	$(INSTALL_DIR) $(1)/usr/lib
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/librrd.so.* $(1)/usr/lib/
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/librrd_th.so.* $(1)/usr/lib/
-	$(INSTALL_DIR) $(1)/usr/share/rrdtool/fonts
+	$(INSTALL_DIR) $(1)/opt/lib
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/librrd.so.* $(1)/opt/lib/
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/librrd_th.so.* $(1)/opt/lib/
+	$(INSTALL_DIR) $(1)/opt/share/rrdtool/fonts
 	$(CP) $(PKG_BUILD_DIR)/src/DejaVuSansMono-Roman.ttf \
-		$(1)/usr/share/rrdtool/fonts/
+		$(1)/opt/share/rrdtool/fonts/
 endef
 
 define Package/rrdcgi/install
-	$(INSTALL_DIR) $(1)/usr/bin
-	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/bin/rrdcgi $(1)/usr/bin/
+	$(INSTALL_DIR) $(1)/opt/bin
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/rrdcgi $(1)/opt/bin/
 endef
 
 define Package/rrdtool/install
-	$(INSTALL_DIR) $(1)/usr/bin
-	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/bin/rrdtool $(1)/usr/bin/
-	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/bin/rrdupdate $(1)/usr/bin/
+	$(INSTALL_DIR) $(1)/opt/bin
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/rrdtool $(1)/opt/bin/
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/rrdupdate $(1)/opt/bin/
 endef
 
 define PyPackage/python-rrd/install
