--- ../../../downloads/mipsel-hardfloat/openwrt_trunk-r40423/feeds/packages/net/freeradius2/Makefile	2014-04-09 16:17:24.166286483 +0400
+++ ../../../openwrt_trunk/feeds/packages/net/freeradius2/Makefile	2014-04-11 12:19:50.379396340 +0400
@@ -42,9 +42,9 @@
 endef
 
 define Package/freeradius2/conffiles
-/etc/freeradius2/clients.conf
-/etc/freeradius2/radiusd.conf
-/etc/freeradius2/sites/default
+/opt/etc/freeradius2/clients.conf
+/opt/etc/freeradius2/radiusd.conf
+/opt/etc/freeradius2/sites/default
 endef
 
 define Package/freeradius2-democerts
@@ -66,7 +66,7 @@
 endef
 
 define Package/freeradius2-mod-chap/conffiles
-/etc/freeradius2/modules/chap
+/opt/etc/freeradius2/modules/chap
 endef
 
 define Package/freeradius2-mod-detail
@@ -76,7 +76,7 @@
 endef
 
 define Package/freeradius2-mod-detail/conffiles
-/etc/freeradius2/modules/detail
+/opt/etc/freeradius2/modules/detail
 endef
 
 define Package/freeradius2-mod-eap
@@ -86,7 +86,7 @@
 endef
 
 define Package/freeradius2-mod-eap/conffiles
-/etc/freeradius2/eap.conf
+/opt/etc/freeradius2/eap.conf
 endef
 
 define Package/freeradius2-mod-eap-gtc
@@ -132,7 +132,7 @@
 endef
 
 define Package/freeradius2-mod-exec/conffiles
-/etc/freeradius2/modules/exec
+/opt/etc/freeradius2/modules/exec
 endef
 
 define Package/freeradius2-mod-expiration
@@ -142,7 +142,7 @@
 endef
 
 define Package/freeradius2-mod-expiration/conffiles
-/etc/freeradius2/modules/expiration
+/opt/etc/freeradius2/modules/expiration
 endef
 
 define Package/freeradius2-mod-always
@@ -152,7 +152,7 @@
 endef
 
 define Package/freeradius2-mod-always/conffiles
-/etc/freeradius2/modules/always
+/opt/etc/freeradius2/modules/always
 endef
 
 define Package/freeradius2-mod-expr
@@ -162,7 +162,7 @@
 endef
 
 define Package/freeradius2-mod-expr/conffiles
-/etc/freeradius2/modules/expr
+/opt/etc/freeradius2/modules/expr
 endef
 
 define Package/freeradius2-mod-attr-filter
@@ -172,11 +172,11 @@
 endef
 
 define Package/freeradius2-mod-attr-filter/conffiles
-/etc/freeradius2/modules/attr_filter
-/etc/freeradius2/attrs
-/etc/freeradius2/attrs.access_reject
-/etc/freeradius2/attrs.accounting_response
-/etc/freeradius2/attrs.pre-proxy
+/opt/etc/freeradius2/modules/attr_filter
+/opt/etc/freeradius2/attrs
+/opt/etc/freeradius2/attrs.access_reject
+/opt/etc/freeradius2/attrs.accounting_response
+/opt/etc/freeradius2/attrs.pre-proxy
 endef
 
 define Package/freeradius2-mod-attr-rewrite
@@ -186,7 +186,7 @@
 endef
 
 define Package/freeradius2-mod-attr-rewrite/conffiles
-/etc/freeradius2/modules/attr_rewrite
+/opt/etc/freeradius2/modules/attr_rewrite
 endef
 
 define Package/freeradius2-mod-files
@@ -196,10 +196,10 @@
 endef
 
 define Package/freeradius2-mod-files/conffiles
-/etc/freeradius2/acct_users
-/etc/freeradius2/preproxy_users
-/etc/freeradius2/users
-/etc/freeradius2/modules/files
+/opt/etc/freeradius2/acct_users
+/opt/etc/freeradius2/preproxy_users
+/opt/etc/freeradius2/users
+/opt/etc/freeradius2/modules/files
 endef
 
 define Package/freeradius2-mod-passwd
@@ -209,7 +209,7 @@
 endef
 
 define Package/freeradius2-mod-passwd/conffiles
-/etc/freeradius2/modules/passwd
+/opt/etc/freeradius2/modules/passwd
 endef
 
 define Package/freeradius2-mod-ldap
@@ -219,8 +219,8 @@
 endef
 
 define Package/freeradius2-mod-ldap/conffiles
-/etc/freeradius2/ldap.attrmap
-/etc/freeradius2/modules/ldap
+/opt/etc/freeradius2/ldap.attrmap
+/opt/etc/freeradius2/modules/ldap
 endef
 
 define Package/freeradius2-mod-logintime
@@ -230,7 +230,7 @@
 endef
 
 define Package/freeradius2-mod-logintime/conffiles
-/etc/freeradius2/modules/logintime
+/opt/etc/freeradius2/modules/logintime
 endef
 
 define Package/freeradius2-mod-mschap
@@ -240,7 +240,7 @@
 endef
 
 define Package/freeradius2-mod-mschap/conffiles
-/etc/freeradius2/modules/mschap
+/opt/etc/freeradius2/modules/mschap
 endef
 
 define Package/freeradius2-mod-pap
@@ -250,7 +250,7 @@
 endef
 
 define Package/freeradius2-mod-pap/conffiles
-/etc/freeradius2/modules/pap
+/opt/etc/freeradius2/modules/pap
 endef
 
 define Package/freeradius2-mod-preprocess
@@ -260,9 +260,9 @@
 endef
 
 define Package/freeradius2-mod-preprocess/conffiles
-/etc/freeradius2/hints
-/etc/freeradius2/huntgroups
-/etc/freeradius2/modules/preprocess
+/opt/etc/freeradius2/hints
+/opt/etc/freeradius2/huntgroups
+/opt/etc/freeradius2/modules/preprocess
 endef
 
 define Package/freeradius2-mod-realm
@@ -272,8 +272,8 @@
 endef
 
 define Package/freeradius2-mod-realm/conffiles
-/etc/freeradius2/proxy.conf
-/etc/freeradius2/modules/realm
+/opt/etc/freeradius2/proxy.conf
+/opt/etc/freeradius2/modules/realm
 endef
 
 define Package/freeradius2-mod-sql
@@ -283,7 +283,7 @@
 endef
 
 define Package/freeradius2-mod-sql/conffiles
-/etc/freeradius2/sql.conf
+/opt/etc/freeradius2/sql.conf
 endef
 
 define Package/freeradius2-mod-sql-mysql
@@ -320,8 +320,8 @@
 endef
 
 define Package/freeradius2-mod-radutmp/conffiles
-/etc/freeradius2/modules/radutmp
-/etc/freeradius2/modules/sradutmp
+/opt/etc/freeradius2/modules/radutmp
+/opt/etc/freeradius2/modules/sradutmp
 endef
 
 define Package/freeradius2-utils
@@ -337,21 +337,21 @@
 endef
 
 CONFIGURE_ARGS+= \
-	--libdir=/usr/lib/freeradius2 \
-	--libexecdir=/usr/lib/freeradius2 \
+	--libdir=/opt/lib/freeradius2 \
+	--libexecdir=/opt/lib/freeradius2 \
 	--enable-shared \
 	--disable-static \
 	--disable-developer \
 	--with-threads \
 	$(if $(CONFIG_FREERADIUS_OPENSSL),--with,--without)-openssl \
-	$(if $(CONFIG_FREERADIUS_OPENSSL),--with-openssl-includes="$(STAGING_DIR)/usr/include",) \
-	$(if $(CONFIG_FREERADIUS_OPENSSL),--with-openssl-libraries="$(STAGING_DIR)/usr/lib",) \
+	$(if $(CONFIG_FREERADIUS_OPENSSL),--with-openssl-includes="$(STAGING_DIR)/opt/include",) \
+	$(if $(CONFIG_FREERADIUS_OPENSSL),--with-openssl-libraries="$(STAGING_DIR)/opt/lib",) \
 	--with-system-libtool \
 	--with-system-libltdl \
 	--enable-strict-dependencies \
-	--with-raddbdir=/etc/freeradius2 \
-	--with-radacctdir=/var/db/radacct \
-	--with-logdir=/var/log \
+	--with-raddbdir=/opt/etc/freeradius2 \
+	--with-radacctdir=/opt/var/db/radacct \
+	--with-logdir=/opt/var/log \
 	--without-edir \
 	--without-snmp \
 	--without-rlm_checkval \
@@ -416,8 +416,8 @@
 
 ifneq ($(SDK)$(CONFIG_PACKAGE_freeradius2-mod-ldap),)
   CONFIGURE_ARGS+= \
-		--with-rlm_ldap-include-dir="$(STAGING_DIR)/usr/include" \
-		--with-rlm_ldap-lib-dir="$(STAGING_DIR)/usr/lib"
+		--with-rlm_ldap-include-dir="$(STAGING_DIR)/opt/include" \
+		--with-rlm_ldap-lib-dir="$(STAGING_DIR)/opt/lib"
   CONFIGURE_LIBS+= -lcrypto -lssl
 else
   CONFIGURE_ARGS+= --without-rlm_ldap
@@ -425,8 +425,8 @@
 
 ifneq ($(SDK)$(CONFIG_PACKAGE_freeradius2-mod-sql-mysql),)
   CONFIGURE_ARGS+= \
-		--with-mysql-include-dir="$(STAGING_DIR)/usr/include" \
-		--with-mysql-lib-dir="$(STAGING_DIR)/usr/lib/mysql"
+		--with-mysql-include-dir="$(STAGING_DIR)/opt/include" \
+		--with-mysql-lib-dir="$(STAGING_DIR)/opt/lib/mysql"
   CONFIGURE_LIBS+= -lz
   CONFIGURE_VARS+= ac_cv_lib_mysqlclient_r_mysql_init=yes
 else
@@ -435,8 +435,8 @@
 
 ifneq ($(SDK)$(CONFIG_PACKAGE_freeradius2-mod-sql-pgsql),)
   CONFIGURE_ARGS+= \
-		--with-rlm_sql_postgresql-include-dir="$(STAGING_DIR)/usr/include" \
-		--with-rlm_sql_postgresql-lib-dir="$(STAGING_DIR)/usr/lib"
+		--with-rlm_sql_postgresql-include-dir="$(STAGING_DIR)/opt/include" \
+		--with-rlm_sql_postgresql-lib-dir="$(STAGING_DIR)/opt/lib"
 else
   CONFIGURE_ARGS+= --without-rlm_sql_postgresql
 endif
@@ -454,8 +454,8 @@
   CONFIGURE_ARGS+= \
 	--with-rlm_sql_sqlite \
 	--with-experimental-modules \
-	--with-sqlite-include-dir="$(STAGING_DIR)/usr/include" \
-	--with-sqlite-lib-dir="$(STAGING_DIR)/usr/lib"
+	--with-sqlite-include-dir="$(STAGING_DIR)/opt/include" \
+	--with-sqlite-lib-dir="$(STAGING_DIR)/opt/lib"
 else
   CONFIGURE_ARGS+= --without-rlm_sql_sqlite
 endif
@@ -463,8 +463,8 @@
 ifneq ($(SDK)$(CONFIG_PACKAGE_freeradius2-mod-eap-peap),)
   CONFIGURE_ARGS+= \
   		--with-rlm_eap_peap \
-		--with-rlm_eap_peap-include-dir="$(STAGING_DIR)/usr/include" \
-		--with-rlm_eap_peap-lib-dir="$(STAGING_DIR)/usr/lib"
+		--with-rlm_eap_peap-include-dir="$(STAGING_DIR)/opt/include" \
+		--with-rlm_eap_peap-lib-dir="$(STAGING_DIR)/opt/lib"
   CONFIGURE_LIBS+= -lcrypto -lssl
 else
   CONFIGURE_ARGS+= --without-rlm_eap_peap
@@ -473,8 +473,8 @@
 ifneq ($(SDK)$(CONFIG_PACKAGE_freeradius2-mod-eap-tls),)
   CONFIGURE_ARGS+= \
   		--with-rlm_eap_tls \
-		--with-rlm_eap_tls-include-dir="$(STAGING_DIR)/usr/include" \
-		--with-rlm_eap_tls-lib-dir="$(STAGING_DIR)/usr/lib"
+		--with-rlm_eap_tls-include-dir="$(STAGING_DIR)/opt/include" \
+		--with-rlm_eap_tls-lib-dir="$(STAGING_DIR)/opt/lib"
   CONFIGURE_LIBS+= -lcrypto -lssl
 else
   CONFIGURE_ARGS+= --without-rlm_eap_tls
@@ -483,8 +483,8 @@
 ifneq ($(SDK)$(CONFIG_PACKAGE_freeradius2-mod-eap-ttls),)
   CONFIGURE_ARGS+= \
   		--with-rlm_eap_ttls \
-		--with-rlm_eap_ttls-include-dir="$(STAGING_DIR)/usr/include" \
-		--with-rlm_eap_ttls-lib-dir="$(STAGING_DIR)/usr/lib"
+		--with-rlm_eap_ttls-include-dir="$(STAGING_DIR)/opt/include" \
+		--with-rlm_eap_ttls-lib-dir="$(STAGING_DIR)/opt/lib"
   CONFIGURE_LIBS+= -lcrypto -lssl
 else
   CONFIGURE_ARGS+= --without-rlm_eap_ttls
@@ -534,61 +534,62 @@
 endef
 
 define Package/freeradius2-common/install
-	$(INSTALL_DIR) $(1)/etc/freeradius2
-	chmod 771 $(1)/etc/freeradius2
-	$(CP) $(PKG_INSTALL_DIR)/etc/freeradius2/dictionary $(1)/etc/freeradius2/ ; \
-	$(INSTALL_DIR) $(1)/usr/lib/freeradius2
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/freeradius2/libfreeradius-radius{,-*}.so $(1)/usr/lib/freeradius2
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/freeradius2/libfreeradius-eap{,-*}.so $(1)/usr/lib/freeradius2
-	$(INSTALL_DIR) $(1)/usr/share/freeradius2
-	$(CP) $(PKG_INSTALL_DIR)/usr/share/freeradius/dictionary $(1)/usr/share/freeradius2/
-	$(SED) "s,^\(\$$$$INCLUDE\),#\1,g" $(1)/usr/share/freeradius2/dictionary
+	$(INSTALL_DIR) $(1)/opt/etc/freeradius2
+	chmod 771 $(1)/opt/etc/freeradius2
+	$(CP) $(PKG_INSTALL_DIR)/opt/etc/freeradius2/dictionary $(1)/opt/etc/freeradius2/ ; \
+	$(INSTALL_DIR) $(1)/opt/lib/freeradius2
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/freeradius2/libfreeradius-radius{,-*}.so $(1)/opt/lib/freeradius2
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/freeradius2/libfreeradius-eap{,-*}.so $(1)/opt/lib/freeradius2
+	$(INSTALL_DIR) $(1)/opt/share/freeradius2
+	$(CP) $(PKG_INSTALL_DIR)/opt/share/freeradius/dictionary $(1)/opt/share/freeradius2/
+	$(SED) "s,^\(\$$$$INCLUDE\),#\1,g" $(1)/opt/share/freeradius2/dictionary
 	for f in $(PKG_DICTIONARIES); do \
-		$(CP) $(PKG_INSTALL_DIR)/usr/share/freeradius/dictionary.$$$${f} $(1)/usr/share/freeradius2/ ; \
-		$(SED) "s,^#\(\$$$$INCLUDE dictionary\.$$$${f}\),\1,g" $(1)/usr/share/freeradius2/dictionary ; \
+		$(CP) $(PKG_INSTALL_DIR)/opt/share/freeradius/dictionary.$$$${f} $(1)/opt/share/freeradius2/ ; \
+		$(SED) "s,^#\(\$$$$INCLUDE dictionary\.$$$${f}\),\1,g" $(1)/opt/share/freeradius2/dictionary ; \
 	done
 endef
 
 define Package/freeradius2/install
-	$(INSTALL_DIR) $(1)/etc/freeradius2/modules
-	$(INSTALL_DIR) $(1)/etc/freeradius2/sites
+	$(INSTALL_DIR) $(1)/opt/etc/freeradius2/modules
+	$(INSTALL_DIR) $(1)/opt/etc/freeradius2/sites
 	for f in clients.conf radiusd.conf policy.conf; do \
-		$(CP) $(PKG_INSTALL_DIR)/etc/freeradius2/$$$${f} $(1)/etc/freeradius2/ ; \
+		$(CP) $(PKG_INSTALL_DIR)/opt/etc/freeradius2/$$$${f} $(1)/opt/etc/freeradius2/ ; \
 	done
-	$(CP) $(PKG_INSTALL_DIR)/etc/freeradius2/sites-available/default $(1)/etc/freeradius2/sites/default
-	$(INSTALL_DIR) $(1)/usr/sbin
-	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/sbin/radiusd $(1)/usr/sbin/
-	$(INSTALL_DIR) $(1)/etc/init.d
-	$(INSTALL_BIN) ./files/radiusd.init $(1)/etc/init.d/radiusd
+	$(CP) $(PKG_INSTALL_DIR)/opt/etc/freeradius2/sites-available/default $(1)/opt/etc/freeradius2/sites/default
+	$(INSTALL_DIR) $(1)/opt/sbin
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/sbin/radiusd $(1)/opt/sbin/
+	$(INSTALL_DIR) $(1)/opt/etc/init.d
+	$(INSTALL_BIN) ./files/S55radiusd $(1)/opt/etc/init.d
+	$(INSTALL_DIR) $(1)/opt/var/{log,run}  $(1)/opt/var/db/radacct
 endef
 
 define Package/freeradius2-democerts/install
-	$(INSTALL_DIR) $(1)/etc/freeradius2/certs
+	$(INSTALL_DIR) $(1)/opt/etc/freeradius2/certs
 	$(CP) \
 		$(PKG_BUILD_DIR)/raddb/certs/ca.pem \
 		$(PKG_BUILD_DIR)/raddb/certs/dh \
 		$(PKG_BUILD_DIR)/raddb/certs/random \
 		$(PKG_BUILD_DIR)/raddb/certs/server.pem \
-		$(1)/etc/freeradius2/certs/
+		$(1)/opt/etc/freeradius2/certs/
 endef
 
 define Package/freeradius2-utils/install
-	$(INSTALL_DIR) $(1)/usr/bin
+	$(INSTALL_DIR) $(1)/opt/bin
 	for f in radclient radeapclient radwho; do \
-		$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/bin/$$$${f} $(1)/usr/bin/ ; \
+		$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/$$$${f} $(1)/opt/bin/ ; \
 	done
 endef
 
 define BuildPlugin
   define Package/$(1)/install
-	[ -z "$(2)" ] || $(INSTALL_DIR) $$(1)/usr/lib/freeradius2
+	[ -z "$(2)" ] || $(INSTALL_DIR) $$(1)/opt/lib/freeradius2
 	for m in $(2); do \
-		$(CP) $(PKG_INSTALL_DIR)/usr/lib/freeradius2/$$$$$$$${m}{,-*}.so $$(1)/usr/lib/freeradius2 ; \
+		$(CP) $(PKG_INSTALL_DIR)/opt/lib/freeradius2/$$$$$$$${m}{,-*}.so $$(1)/opt/lib/freeradius2 ; \
 	done
-	[ -z "$(3)" ] || $(INSTALL_DIR) $$(1)/etc/freeradius2
-	[ -z "$(4)" ] || $(INSTALL_DIR) $$(1)/etc/freeradius2/$(4)
+	[ -z "$(3)" ] || $(INSTALL_DIR) $$(1)/opt/etc/freeradius2
+	[ -z "$(4)" ] || $(INSTALL_DIR) $$(1)/opt/etc/freeradius2/$(4)
 	for f in $(3); do \
-		$(CP) $(PKG_INSTALL_DIR)/etc/freeradius2/$$$$$$$${f} $$(1)/etc/freeradius2/$$$$$$$${f} ; \
+		$(CP) $(PKG_INSTALL_DIR)/opt/etc/freeradius2/$$$$$$$${f} $$(1)/opt/etc/freeradius2/$$$$$$$${f} ; \
 	done
   endef
 
