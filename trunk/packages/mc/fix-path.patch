--- ../../../downloads/openwrt_trunk-r34568/feeds/packages/utils/mc/Makefile	2012-12-07 16:49:57.679447500 +0400
+++ ../../../openwrt_trunk/feeds/packages/utils/mc/Makefile	2012-12-11 13:05:40.840221569 +0400
@@ -8,15 +8,16 @@
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=mc
-PKG_VERSION:=4.7.5.3
-PKG_RELEASE:=2
+PKG_VERSION:=4.8.6
+PKG_RELEASE:=1
 
 PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.bz2
 PKG_SOURCE_URL:=http://www.midnight-commander.org/downloads/
-PKG_MD5SUM:=6a67e139e0032d8a871455a80d490941
+PKG_MD5SUM:=323706aa5e77698bed7b0b6faa7c1530
 
 PKG_BUILD_PARALLEL:=1
 PKG_FIXUP:=autoreconf
+PKG_INSTALL:=1
 
 include $(INCLUDE_DIR)/package.mk
 include $(INCLUDE_DIR)/nls.mk
@@ -24,7 +25,7 @@
 define Package/mc
   SECTION:=utils
   CATEGORY:=Utilities
-  DEPENDS:=+glib2 +libncurses $(LIBRPC_DEPENDS) $(ICONV_DEPENDS)
+  DEPENDS:=+glib2 +libslang2 $(ICONV_DEPENDS) $(INTL_DEPENDS)
   TITLE:=midnight commander - a powerful file manager
   URL:=http://www.midnight-commander.org/
   SUBMENU:=filemanager
@@ -44,13 +45,17 @@
  subshell.
 endef
 
+CONFIGURE_VARS += \
+	fu_cv_sys_stat_statfs2_bsize=yes \
+
 CONFIGURE_ARGS += \
-	--enable-utf8 \
 	--disable-doxygen-doc \
-	--with-screen=ncurses \
-	--without-gpm-mouse \
+	--with-screen=slang \
+	--with-slang-includes="$(STAGING_DIR)/opt/include" \
+	--with-slang-libs="$(STAGING_DIR)/opt/lib" \
+	--with-search-engine=glib \
 	--without-x \
-	ac_cv_search_addwstr=no
+	--without-gpm-mouse \
 
 ifeq ($(CONFIG_MC_DIFF_VIEWER),n)
 CONFIGURE_ARGS += \
@@ -73,24 +78,25 @@
 endif
 
 define Package/mc/install
-	$(INSTALL_DIR) $(1)/usr/bin
-	$(INSTALL_BIN) $(PKG_BUILD_DIR)/src/mc $(1)/usr/bin
-	$(INSTALL_DIR) $(1)/etc/mc
+	$(INSTALL_DIR) $(1)/opt/bin
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/mc $(1)/opt/bin/
+	$(INSTALL_DIR) $(1)/opt/etc $(1)/opt/etc/mc
 ifeq ($(CONFIG_MC_DIFF_VIEWER),y)
-	ln -sf mc $(1)/usr/bin/mcdiff
+	ln -sf mc $(1)/opt/bin/mcdiff
 endif
 ifeq ($(CONFIG_MC_EDITOR),y)
-	ln -sf mc $(1)/usr/bin/mcedit
+	ln -sf mc $(1)/opt/bin/mcedit
 endif
-	$(INSTALL_DATA) $(PKG_BUILD_DIR)/misc/mc.menu $(1)/etc/mc
-	$(INSTALL_DIR) $(1)/etc/mc/skins
-	$(INSTALL_DATA) $(PKG_BUILD_DIR)/misc/skins/default.ini $(1)/etc/mc/skins
-	$(INSTALL_DIR) $(1)/root/.mc/cedit/Syntax
+	$(CP) $(PKG_INSTALL_DIR)/opt/etc/mc/* $(1)/opt/etc/mc/
+	$(INSTALL_DIR) $(1)/opt/lib $(1)/opt/lib/mc $(1)/opt/lib/mc/extfs.d $(1)/opt/lib/mc/fish
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/mc/* $(1)/opt/lib/mc/
+	$(INSTALL_DIR) $(1)/opt/share $(1)/opt/share/mc $(1)/opt/share/mc/help $(1)/opt/share/mc/skins $(1)/opt/share/mc/hints $(1)/opt/share/mc/syntax
+	$(CP) $(PKG_INSTALL_DIR)/opt/share/mc/* $(1)/opt/share/mc/
 endef
 
 define Package/mc/conffiles
-/etc/mc/mc.menu
-/etc/mc/skins/default.ini
+/opt/etc/mc/mc.menu
+/opt/etc/mc/mcedit.menu
 endef
 
 $(eval $(call BuildPackage,mc))
