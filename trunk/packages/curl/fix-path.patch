--- ../../../downloads/openwrt_trunk-r35953/feeds/packages/libs/curl/Makefile	2013-03-11 09:29:39.194073817 +0400
+++ ../../../openwrt_trunk/feeds/packages/libs/curl/Makefile	2013-03-14 12:14:39.609175007 +0400
@@ -9,7 +9,7 @@
 
 PKG_NAME:=curl
 PKG_VERSION:=7.29.0
-PKG_RELEASE:=1
+PKG_RELEASE:=1a
 
 PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.bz2
 PKG_SOURCE_URL:=http://curl.haxx.se/download/ \
@@ -46,7 +46,7 @@
   $(call Package/curl/Default)
   SECTION:=libs
   CATEGORY:=Libraries
-  DEPENDS:=+libopenssl +zlib
+  DEPENDS:=+libopenssl +zlib +librtmp +libidn
   TITLE:=A client-side URL transfer library
 endef
 
@@ -73,18 +73,19 @@
 	--enable-tftp \
 	--disable-verbose \
 	--with-random="/dev/urandom" \
-	--with-ssl="$(STAGING_DIR)/usr" \
+	--with-ssl="$(STAGING_DIR)/opt" \
 	--without-ca-bundle \
 	--without-gnutls \
 	--without-krb4 \
-	--without-libidn \
+	--with-libidn="$(STAGING_DIR)/opt" \
+	--with-librtmp="$(STAGING_DIR)/opt" \
 	--without-nss \
 	--without-libssh2 \
-	--with-zlib="$(STAGING_DIR)/usr" \
+	--with-zlib="$(STAGING_DIR)/opt" \
 	$(call autoconf_bool,CONFIG_IPV6,ipv6) \
 
 CONFIGURE_VARS += \
-	LIBS="-lcrypto -lssl -lz" \
+	LIBS="-lcrypto -lssl -lz -lrtmp" \
 	CC="$(filter-out ccache,$(TARGET_CC))"
 
 define Build/Compile
@@ -95,24 +96,24 @@
 endef
 
 define Build/InstallDev
-	$(INSTALL_DIR) $(2)/bin $(1)/usr/bin $(1)/usr/include $(1)/usr/lib $(1)/usr/lib/pkgconfig
-	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/bin/curl-config $(1)/usr/bin/
-	$(CP) $(PKG_INSTALL_DIR)/usr/include/curl $(1)/usr/include/
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/libcurl.{a,so*} $(1)/usr/lib/
-	$(CP) $(PKG_BUILD_DIR)/libcurl.pc $(1)/usr/lib/pkgconfig/
-	$(SED) 's,-L$$$${exec_prefix}/lib,,g' $(1)/usr/bin/curl-config
-	[ -n "$(TARGET_LDFLAGS)" ] && $(SED) 's#$(TARGET_LDFLAGS)##g' $(1)/usr/lib/pkgconfig/libcurl.pc || true
-	ln -sf $(STAGING_DIR)/usr/bin/curl-config $(2)/bin/
+	$(INSTALL_DIR) $(2)/bin $(1)/opt/bin $(1)/opt/include $(1)/opt/lib $(1)/opt/lib/pkgconfig
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/curl-config $(1)/opt/bin/
+	$(CP) $(PKG_INSTALL_DIR)/opt/include/curl $(1)/opt/include/
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/libcurl.{a,so*} $(1)/opt/lib/
+	$(CP) $(PKG_BUILD_DIR)/libcurl.pc $(1)/opt/lib/pkgconfig/
+	$(SED) 's,-L$$$${exec_prefix}/lib,,g' $(1)/opt/bin/curl-config
+	[ -n "$(TARGET_LDFLAGS)" ] && $(SED) 's#$(TARGET_LDFLAGS)##g' $(1)/opt/lib/pkgconfig/libcurl.pc || true
+	ln -sf $(STAGING_DIR)/opt/bin/curl-config $(2)/bin/
 endef
 
 define Package/curl/install
-	$(INSTALL_DIR) $(1)/usr/bin
-	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/usr/bin/curl $(1)/usr/bin/
+	$(INSTALL_DIR) $(1)/opt/bin
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/curl $(1)/opt/bin/
 endef
 
 define Package/libcurl/install
-	$(INSTALL_DIR) $(1)/usr/lib
-	$(CP) $(PKG_INSTALL_DIR)/usr/lib/libcurl.so.* $(1)/usr/lib/
+	$(INSTALL_DIR) $(1)/opt/lib
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/libcurl.so.* $(1)/opt/lib/
 endef
 
 $(eval $(call BuildPackage,curl))
