--- ../../../trunk_clean/feeds/packages/utils/mc/Makefile	2012-04-02 11:00:50.300013820 +0400
+++ ../../../trunk/feeds/packages/utils/mc/Makefile	2012-04-02 16:25:54.044718997 +0400
@@ -8,15 +8,14 @@
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=mc
-PKG_VERSION:=4.7.5.3
-PKG_RELEASE:=2
+PKG_VERSION:=4.8.2
+PKG_RELEASE:=1
+PKG_INSTALL:=1
 
 PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.bz2
 PKG_SOURCE_URL:=http://www.midnight-commander.org/downloads/
-PKG_MD5SUM:=6a67e139e0032d8a871455a80d490941
+PKG_MD5SUM:=54eba7680f3e24fbdb8d83e2cde9eca3
 
-PKG_BUILD_PARALLEL:=1
-PKG_FIXUP:=autoreconf
 
 include $(INCLUDE_DIR)/package.mk
 include $(INCLUDE_DIR)/nls.mk
@@ -24,7 +23,7 @@
 define Package/mc
   SECTION:=utils
   CATEGORY:=Utilities
-  DEPENDS:=+glib2 +libncurses $(LIBRPC_DEPENDS) $(ICONV_DEPENDS)
+  DEPENDS:=+glib2 +libncurses +libslang2 $(LIBRPC_DEPENDS) $(ICONV_DEPENDS)
   TITLE:=midnight commander - a powerful file manager
   URL:=http://www.midnight-commander.org/
   SUBMENU:=filemanager
@@ -47,10 +46,14 @@
 CONFIGURE_ARGS += \
 	--enable-utf8 \
 	--disable-doxygen-doc \
-	--with-screen=ncurses \
+	--with-screen=slang \
 	--without-gpm-mouse \
 	--without-x \
-	ac_cv_search_addwstr=no
+	--sysconfdir="/opt/etc" \
+	--with-slang-includes="$(STAGING_DIR)/opt/include" \
+	--with-slang-libs="$(STAGING_DIR)/opt/lib" \
+	ac_cv_search_addwstr=no \
+	fu_cv_sys_stat_statvfs=yes
 
 ifeq ($(CONFIG_MC_DIFF_VIEWER),n)
 CONFIGURE_ARGS += \
@@ -73,24 +76,25 @@
 endif
 
 define Package/mc/install
-	$(INSTALL_DIR) $(1)/usr/bin
-	$(INSTALL_BIN) $(PKG_BUILD_DIR)/src/mc $(1)/usr/bin
-	$(INSTALL_DIR) $(1)/etc/mc
+	$(INSTALL_DIR) $(1)/opt/bin
+	$(INSTALL_BIN) $(PKG_INSTALL_DIR)/opt/bin/mc $(1)/opt/bin/
+	$(INSTALL_DIR) $(1)/opt/etc $(1)/opt/etc/mc
 ifeq ($(CONFIG_MC_DIFF_VIEWER),y)
-	ln -sf mc $(1)/usr/bin/mcdiff
+	ln -sf mc $(1)/opt/bin/mcdiff
 endif
 ifeq ($(CONFIG_MC_EDITOR),y)
-	ln -sf mc $(1)/usr/bin/mcedit
+	ln -sf mc $(1)/opt/bin/mcedit
 endif
-	$(INSTALL_DATA) $(PKG_BUILD_DIR)/misc/mc.menu $(1)/etc/mc
-	$(INSTALL_DIR) $(1)/etc/mc/skins
-	$(INSTALL_DATA) $(PKG_BUILD_DIR)/misc/skins/default.ini $(1)/etc/mc/skins
-	$(INSTALL_DIR) $(1)/root/.mc/cedit/Syntax
+	$(CP) $(PKG_INSTALL_DIR)/opt/etc/mc/* $(1)/opt/etc/mc/
+	$(INSTALL_DIR) $(1)/opt/lib $(1)/opt/lib/mc $(1)/opt/lib/mc/extfs.d $(1)/opt/lib/mc/fish
+	$(CP) $(PKG_INSTALL_DIR)/opt/lib/mc/* $(1)/opt/lib/mc/
+	$(INSTALL_DIR) $(1)/opt/share $(1)/opt/share/mc $(1)/opt/share/mc/help $(1)/opt/share/mc/skins $(1)/opt/share/mc/hints $(1)/opt/share/mc/syntax
+	$(CP) $(PKG_INSTALL_DIR)/opt/share/mc/* $(1)/opt/share/mc/
 endef
 
 define Package/mc/conffiles
-/etc/mc/mc.menu
-/etc/mc/skins/default.ini
+#/opt/etc/mc/mc.menu
+#/opt/etc/mc/skins/default.ini
 endef
 
 $(eval $(call BuildPackage,mc))
